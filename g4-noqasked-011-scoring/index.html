<!DOCTYPE html><html lang="ko-kr" >

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  
  
    <meta name="generator" content="Wowchemy 5.3.0 for Hugo" />
  

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Evan Kim" />

  
  
  
    
  
  <meta name="description" content="Geant4 무작정 따라하기 시리즈의 열한번째. Geant4에서 스코어링을 구현하는 방법에 대해 알아봅니다." />

  
  <link rel="alternate" hreflang="ko-kr" href="https://evandde.github.io/g4-noqasked-011-scoring/" />

  









  




  
  
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  

  
  
  
    <meta name="theme-color" content="#1565c0" />
  

  
  

  

  <link rel="stylesheet" href="/css/vendor-bundle.min.f1ecf783c14edc00c9320c205831ad8e.css" media="print" onload="this.media='all'">

  
  
  
    
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.0/css/academicons.min.css" integrity="sha512-W4yqoT1+8NLkinBLBZko+dFB2ZbHsYLDdr50VElllRcNt2Q4/GSs6u71UHKxB7S6JEMCp5Ve4xjh3eGQl/HRvg==" crossorigin="anonymous" media="print" onload="this.media='all'">
    

    
    
    
    
      
      
    
    
    

    
    
    
      
    
    
      
      
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/foundation.min.css" crossorigin="anonymous" title="hl-light" media="print" onload="this.media='all'">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/foundation.min.css" crossorigin="anonymous" title="hl-dark" media="print" onload="this.media='all'" disabled>
      
    

    
    
    

    

    
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      
        
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
  

  
  
  
    
      
      <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@500&family=Noto+Sans+KR:wght@400;700&display=swap">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@500&family=Noto+Sans+KR:wght@400;700&display=swap" media="print" onload="this.media='all'">
    
  

  
  
  
  
  
  <link rel="stylesheet" href="/css/wowchemy.75edb75c66f2d6f0a9a146b10c65f58e.css" />

  



  
<script>
  (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-P6CTCPW');
</script>


  

  




  
  
  

  

  
    <link rel="manifest" href="/manifest.webmanifest" />
  

  <link rel="icon" type="image/png" href="/media/icon_hu8e7e87b14a52eedd9109bf1b224bd29e_18847_32x32_fill_lanczos_center_3.png" />
  <link rel="apple-touch-icon" type="image/png" href="/media/icon_hu8e7e87b14a52eedd9109bf1b224bd29e_18847_180x180_fill_lanczos_center_3.png" />

  <link rel="canonical" href="https://evandde.github.io/g4-noqasked-011-scoring/" />

  
  
  
  
  
  
  
  
    
    
  
  
  <meta property="twitter:card" content="summary" />
  
  <meta property="og:site_name" content="EvaNote" />
  <meta property="og:url" content="https://evandde.github.io/g4-noqasked-011-scoring/" />
  <meta property="og:title" content="Geant4 무작정 따라하기 - 11. 스코어링 구현 | EvaNote" />
  <meta property="og:description" content="Geant4 무작정 따라하기 시리즈의 열한번째. Geant4에서 스코어링을 구현하는 방법에 대해 알아봅니다." /><meta property="og:image" content="https://evandde.github.io/media/icon_hu8e7e87b14a52eedd9109bf1b224bd29e_18847_512x512_fill_lanczos_center_3.png" />
    <meta property="twitter:image" content="https://evandde.github.io/media/icon_hu8e7e87b14a52eedd9109bf1b224bd29e_18847_512x512_fill_lanczos_center_3.png" /><meta property="og:locale" content="ko-kr" />
  
    
      <meta
        property="article:published_time"
        content="2021-08-18T14:11:10&#43;09:00"
      />
    
    <meta property="article:modified_time" content="2021-08-18T14:11:10&#43;09:00">
  

  



  

  

  





  <title>Geant4 무작정 따라하기 - 11. 스코어링 구현 | EvaNote</title>
</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="page-wrapper   " data-wc-page-id="d86058681b3208ea888006ed888b3500" >

  
  
  
  
  
  
  
  
  
  <script src="/js/wowchemy-init.min.8988fb2a4bba758785868cfcb5244555.js"></script>

  


<aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>검색</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#" aria-label="Close"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="검색..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control"
        aria-label="검색...">
        
      </div>

      
      

      

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>



  <div class="page-header">
    












<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container-xl">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="/">EvaNote</a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar-content" aria-expanded="false" aria-label="네비게이션">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="/">EvaNote</a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/post"><span>포스트</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/course"><span>강의시리즈</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
            
            
            
              
            
            
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#categories"><span>카테고리</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
            
            
            
              
            
            
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#tags"><span>태그</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
            
            
            
              
            
            
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#about"><span>소개</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">

      
      
        
      

      
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#" aria-label="검색"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      
      

      
      

    </ul>

  </div>
</nav>


  </div>

  <div class="page-body">
    





<div class="container-fluid docs">
  <div class="row flex-xl-nowrap">
    <div class="col-12 col-md-3 col-xl-2 docs-sidebar">
      <form class="docs-search d-flex align-items-center">
  <button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type="button" data-toggle="collapse" data-target="#docs-nav" aria-controls="docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    <div class="d-flex">
      <span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">
        
          스코어링
        
      </span>
      <span><i class="fas fa-chevron-down"></i></span>
    </div>
  </button>

  
  <button class="form-control sidebar-search js-search d-none d-md-flex">
    <i class="fas fa-search pr-2"></i>
    <span class="sidebar-search-text">검색...</span>
    <span class="sidebar-search-shortcut">/</span>
  </button>
  
</form>

<nav class="collapse docs-links" id="docs-nav">
  
  
  
  
  
  

  
  
    

    
      

      <ul class="nav docs-sidenav">
        <li><a href="/course/"><i class="fas fa-arrow-left pr-1"></i>Courses</a></li>
      </ul>

      
      
        
          
        
      


  
    
    
    
    
      
    
    

    
      <div class="docs-toc-item">
        <a class="docs-toc-link " href="/course/g4-noqasked/">Geant4 무작정 따라하기</a>
    
      
        <ul class="nav docs-sidenav">
      


  <li class=""><a href="/g4-noqasked-000-opening/">들어가며</a></li>



  <li class=""><a href="/g4-noqasked-001-clonetest/">템플릿 코드 실행하기</a></li>



  
    
    
    
    
      
    
    

    
      <div class="docs-toc-item">
        <a class="docs-toc-link " href="/course/g4-noqasked/g4-noqasked-geometry/">지오메트리</a>
    
      
        <ul class="nav docs-sidenav">
      


  <li class=""><a href="/g4-noqasked-002-detcon/">지오메트리 정의 기본이론</a></li>



  <li class=""><a href="/g4-noqasked-003-solid/">지오메트리 모양 만들기</a></li>



  <li class=""><a href="/g4-noqasked-004-material/">물질 정의 및 사용</a></li>



  <li class=""><a href="/g4-noqasked-005-clhepclasses/">위치, 회전을 정의하는 법</a></li>



  <li class=""><a href="/g4-noqasked-006-phyvol/">지오메트리 배치하기</a></li>

      
        </ul>
      
    

    
      </div>
    



  
    
    
    
    
      
    
    

    
      <div class="docs-toc-item">
        <a class="docs-toc-link " href="/course/g4-noqasked/g4-noqasked-verbose/">Verbose</a>
    
      
        <ul class="nav docs-sidenav">
      


  <li class=""><a href="/g4-noqasked-007-trkvb/">기본용어와 Tracking Verbose</a></li>

      
        </ul>
      
    

    
      </div>
    



  
    
    
    
    
      
    
    

    
      <div class="docs-toc-item">
        <a class="docs-toc-link " href="/course/g4-noqasked/g4-noqasked-primgen/">선원항</a>
    
      
        <ul class="nav docs-sidenav">
      


  <li class=""><a href="/g4-noqasked-008-prigen/">선원항을 정의하는 법</a></li>



  <li class=""><a href="/g4-noqasked-009-randtool/">난수 기반 선원항 정의하기</a></li>

      
        </ul>
      
    

    
      </div>
    



  
    
    
    
    
      
    
    

    
      <div class="docs-toc-item">
        <a class="docs-toc-link " href="/course/g4-noqasked/g4-noqasked-scoring/">스코어링</a>
    
      
        <ul class="nav docs-sidenav">
      


  <li class=""><a href="/g4-noqasked-010-scoringtheory/">스코어링 이론</a></li>



  <li class="active"><a href="/g4-noqasked-011-scoring/">스코어링 구현하기</a></li>



  <li class=""><a href="/g4-noqasked-012-writingrslt1/">결과를 Histogram으로 기록하기</a></li>



  <li class=""><a href="/g4-noqasked-013-writingrslt2/">결과를 Ntuple로 기록하기</a></li>

      
        </ul>
      
    

    
      </div>
    



  
    
    
    
    
      
    
    

    
      <div class="docs-toc-item">
        <a class="docs-toc-link " href="/course/g4-noqasked/g4-noqasked-closing/">Geant4 무작정 따라하기</a>
    
      
        <ul class="nav docs-sidenav">
      


  <li class=""><a href="/g4-noqasked-014-closing/">마치며</a></li>

      
        </ul>
      
    

    
      </div>
    

      
        </ul>
      
    

    
      </div>
    

    
  
</nav>

    </div>

    
    
    <div class="d-none d-xl-block col-xl-2 docs-toc">
      

      <ul class="nav toc-top">
        <li><a href="#" id="back_to_top" class="docs-toc-title">목차</a></li>
      </ul>

      <nav id="TableOfContents">
  <ul>
    <li><a href="#sensitive-detector-설계">Sensitive Detector 설계</a>
      <ul>
        <li><a href="#mfd-만들고-추가하기">MFD 만들고 추가하기</a></li>
        <li><a href="#ps-등록하기">PS 등록하기</a></li>
      </ul>
    </li>
    <li><a href="#logical-volume에-sd-세팅">Logical Volume에 SD 세팅</a></li>
    <li><a href="#중간-점검">중간 점검</a></li>
    <li><a href="#event가-끝날-때-hit-확인">Event가 끝날 때 Hit 확인</a>
      <ul>
        <li><a href="#hcofthisevent에서-hc-꺼내기">HCofThisEvent에서 HC 꺼내기</a></li>
        <li><a href="#hc에서-hit-꺼내기">HC에서 Hit 꺼내기</a></li>
        <li><a href="#결과-확인">결과 확인</a></li>
      </ul>
    </li>
    <li><a href="#최종-파일-다운받는-법">최종 파일 다운받는 법</a></li>
    <li><a href="#정리">정리</a></li>
  </ul>
</nav>

      
    </div>
    

    <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 docs-content" role="main">

      <article class="article">

        <div class="docs-article-container">
          
            
  <nav class="d-none d-md-flex" aria-label="breadcrumb">
    <ol class="breadcrumb">
      
  
  
  
  

  <li class="breadcrumb-item">
    <a href="/">
      
        Home
      
    </a>
  </li>


  <li class="breadcrumb-item">
    <a href="/course/">
      
        Courses
      
    </a>
  </li>


  <li class="breadcrumb-item">
    <a href="/course/g4-noqasked/">
      
        Geant4 무작정 따라하기
      
    </a>
  </li>


  <li class="breadcrumb-item">
    <a href="/course/g4-noqasked/g4-noqasked-scoring/">
      
        스코어링
      
    </a>
  </li>


      <li class="breadcrumb-item active" aria-current="page">
        스코어링 구현하기
      </li>
    </ol>
  </nav>


          

          <h1>Geant4 무작정 따라하기 - 11. 스코어링 구현</h1>

          <div class="article-style">
            <p>Geant4 무작정 따라하기 시리즈의 열한번째. Geant4에서 스코어링을 구현하는 방법에 대해 알아봅니다.</p>
<p>지난 글에서 살펴본 스코어링 이론을 바탕으로, 이번 글에서는 스코어링을 직접 구현해보도록 하겠습니다.</p>
<p>스코어링을 구현하는 방법은 크게 다음의 3단계를 통해 진행됩니다.</p>
<ol>
<li>스코어링을 위한 Sensitive Detector 설계</li>
<li>관심 있는 지오메트리의 Logical Volume에 Sensitive Detector를 세팅</li>
<li>Event가 끝날 때 HCofThisEvent에서 Hit(관심 있는 물리량)을 꺼내어 확인</li>
</ol>
<p>차례차례 살펴보도록 합시다.</p>
<hr>
<h2 id="sensitive-detector-설계">Sensitive Detector 설계</h2>
<p>Sensitive Detector를 설계하는 방법은 지난 글에서 말씀드렸습니다. 이 시리즈에서는 Multi Functional Detector(MFD)에 사용자가 원하는 Primitive Scorer들을 Register하여 설계하는 방법만 다루겠다고 하였지요.</p>
<p>이 내용을 코드로 입력하는 곳도 정해져 있습니다. 바로 <b>DetectorConstruction.cc 파일</b>에 있는 <b>ConstructSDandField() 함수 내부</b>입니다. DetectorConstruction.cc 파일을 열어보시면, 대부분의 경우 맨 아래쪽 부근에 다음과 같은 함수가 있을 것입니다. 이 함수의 중괄호({}) 내부에 작성할 것입니다.</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="01_consdandfield" srcset="
               /g4-noqasked-011-scoring/01_consdandfield_hud5d43139c37466f8384ee604e5938563_110949_2762534b1972bedebc739330bcc7b675.png 400w,
               /g4-noqasked-011-scoring/01_consdandfield_hud5d43139c37466f8384ee604e5938563_110949_ea3ae354bc37906f7c0fdca93bff164f.png 760w,
               /g4-noqasked-011-scoring/01_consdandfield_hud5d43139c37466f8384ee604e5938563_110949_1200x1200_fit_lanczos_3.png 1200w"
               src="/g4-noqasked-011-scoring/01_consdandfield_hud5d43139c37466f8384ee604e5938563_110949_2762534b1972bedebc739330bcc7b675.png"
               width="760"
               height="504"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p><font color=red>물론, 관련한 헤더는 당연히 DetectorConstruction.cc 파일의 맨 위에 포함시켜 주셔야 합니다. 여기서 필요한 헤더는 다음과 같습니다.</font></p>
<ul>
<li><font color=red>G4SDManager.hh</font></li>
<li><font color=red>G4MultiFunctionalDetector.hh</font></li>
<li><font color=red>사용한 PrimitiveScorer와 Filter의 헤더 (G4PSEnergyDeposit.hh 등)</font></li>
</ul>
<h3 id="mfd-만들고-추가하기">MFD 만들고 추가하기</h3>
<p>Multi Functional Detector를 만드는 과정은 딱 두 가지만 하시면 됩니다.</p>
<ol>
<li>G4MultiFunctionalDetector 클래스의 객체를 만든다.</li>
<li>해당 객체를 G4SDManager에 추가한다.</li>
</ol>
<p>코드로는 다음의 두 줄입니다.</p>
<pre><code class="language-cpp">auto mfd = new G4MultiFunctionalDetector(&quot;Detector&quot;);
G4SDManager::GetSDMpointer()-&gt;AddNewDetector(mfd);
</code></pre>
<p>mfd라는 변수명으로 객체를 만들고, 이를 추가해주었습니다.</p>
<p>좀 더 자세히 살펴보도록 하죠.</p>
<h4 id="mfd-객체-만들기">MFD 객체 만들기</h4>
<p>Geant4에서는 Multi Functional Detector를 만들기 위해 이름 그대로 G4MultiFunctionalDetector라는 클래스를 제공하고 있습니다. 사용자는 이 클래스의 생성자를 이용하여 객체를 한 개 만들어주면 됩니다.</p>
<p>이 클래스의 생성자는 다음과 같습니다.</p>
<pre><code class="language-cpp">G4MultiFunctionalDetector(G4String name);
</code></pre>
<ul>
<li>name: Multi Functional Detector의 이름. 자유롭게 적으면 됨. <b>나중에 쓰이는 값이므로 기억</b>해둘 것</li>
</ul>
<p>문자열 형태의 입력값 한 개만 자유롭게 넣어주면 됩니다. 입력 인자로 넣어준 <b>이 값은 MFD의 이름</b>이 되는데, 나중에 HCofThisEvent에서 사용되니 적절한 이름으로 잘 지어주세요. 위 예시 코드에서는 &ldquo;Detector&quot;라는 이름을 지어주었습니다.</p>
<h4 id="mfd-추가하기">MFD 추가하기</h4>
<p>Geant4에서 Sensitive Detector를 사용하기 위해서는 <b>반드시 G4SDManager에 그 SD를 추가</b>해주어야 합니다. 그래야 Geant4가 입자를 수송하면서 SD 목록 중 조건에 부합하는 것들에 대해 스코어링을 수행해주기 때문입니다.</p>
<p>G4SDManager는 Geant4가 제공하는 것을 가져다 쓰면 되며, 이 클래스가 제공하는 <b>AddNewDetector()라는 함수를 통해 우리가 설계한 SD를 추가</b>하게 됩니다. 이 함수의 원형은 다음과 같습니다.</p>
<pre><code class="language-cpp">void AddNewDetector(G4VSensitiveDetector *aSD);
</code></pre>
<ul>
<li>aSD: 추가할 Sensitive Detector 객체의 포인터</li>
</ul>
<div class="alert alert-note">
  <div>
    C++적인 내용을 덧붙이자면, G4MultiFunctionalDetector 클래스는 G4VSensitiveDetector 클래스를 상속받아 만들어진 클래스입니다. 따라서, MFD 객체를 AddNewDetector의 인자로 사용할 수 있는 것입니다.
  </div>
</div>

<p>이 함수의 입력 인자로, 앞서 저희가 만들어둔 MFD 객체를 그대로 써주시면 됩니다.</p>
<h3 id="ps-등록하기">PS 등록하기</h3>
<p>이제 MFD는 만들었으니, 실제 스코어링 기능을 수행하는 Primitive Scorer를 등록해야 합니다. 이 내용도 <b>ConstructSDandField() 함수 내부</b>에 위에서 작성한 두 줄에 이어서 계속 써주시면 됩니다.</p>
<p>여기도 딱 두 가지만 해주시면 됩니다.</p>
<ol>
<li>원하는 Primitive Scorer 클래스의 객체를 만든다.</li>
<li>해당 PS 객체를 MFD에 등록한다.</li>
</ol>
<p>예를 들어 해당 지오메트리 내에 deposit된 에너지의 총합을 스코어링하는 G4PSEnergyDeposit을 등록하고 싶다면, 다음과 같이 두 줄을 작성하면 됩니다.</p>
<pre><code class="language-cpp">auto psEDep = new G4PSEnergyDeposit(&quot;EDep&quot;);
mfd-&gt;RegisterPrimitive(psEDep);
</code></pre>
<p>psEDep이라는 변수명으로 G4PSEnergyDeposit 클래스의 객체를 만들고, 이를 앞서 만들어둔 mfd 변수명으로 정의된 MFD 객체에 등록해주었습니다.</p>
<p>좀 더 자세히 살펴보겠습니다.</p>
<h4 id="ps-객체-만들기">PS 객체 만들기</h4>
<p>Primitive Scorer의 종류가 너무 많기 때문에, 이 글에서 모든 PS의 생성자를 살펴볼 수는 없습니다. 하지만 <b>모든 PS의 생성자에 있어 공통적으로 중요한 내용</b>이 있습니다. 대표적으로 G4PSEnergyDeposit 클래스의 생성자를 살펴봅시다.</p>
<pre><code class="language-cpp">G4PSEnergyDeposit(G4String name, G4int depth=0);
G4PSEnergyDeposit(G4String name, const G4String&amp; unit, G4int depth=0);
</code></pre>
<ul>
<li>name: Primitive Scorer의 이름. 자유롭게 적으면 됨. <b>나중에 쓰이는 값이므로 기억</b>해둘 것</li>
<li><i>depth:  <b>입력하지 않아도 되는 인자</b>.지오메트리의 관계(mother-daughter)에 따라, 상위 몇 번째 단계에 있는 지오메트리의 copy number를 참고할 것인지를 지정하는 인자. 기본값은 0</i></li>
<li><i>unit:  <b>입력하지 않아도 되는 인자</b>. 스코어링 결과의 입출력시 사용할 단위. 기본값은 MeV</i></li>
</ul>
<p>MFD 객체를 만들 때와 마찬가지로, 문자열 형태의 입력값 한 개만 자유롭게 넣어주면 됩니다. 이 <b>입력 인자는 어느 PS를 사용하든 무조건 입력해주도록 되어있으며, 이 값이 해당 PS의 이름</b>이 됩니다.</p>
<p>이 또한 나중에 HCofThisEvent에서 사용되니 적절한 이름으로 잘 지어주세요. 위 예시 코드에서는 &ldquo;EDep&quot;라는 이름을 지어주었습니다.</p>
<h4 id="mfd에-ps-등록하기">MFD에 PS 등록하기</h4>
<p>MFD에 PS를 등록할 때에는, G4MultiFunctionalDetector 클래스가 제공하는 <b>RegisterPrimitive() 함수를 이용</b>합니다. 이 함수의 원형은 다음과 같습니다.</p>
<pre><code class="language-cpp">G4bool RegisterPrimitive(G4VPrimitiveScorer *aPS);
</code></pre>
<ul>
<li>aPS: 등록할 Primitive Scorer 객체의 포인터</li>
</ul>
<p>이 함수의 입력 인자로, 앞서 저희가 만들어둔 PS의 객체를 그대로 써주시면 됩니다.</p>
<h4 id="여러-개의-ps를-등록하는-법">여러 개의 PS를 등록하는 법</h4>
<p>하나의 MFD에 여러 개의 PS를 등록하는 방법도 간단합니다. 위에서 설명한 두 과정만 계속 반복해주시면 됩니다.</p>
<ol>
<li>원하는 Primitive Scorer 클래스의 객체를 만든다.</li>
<li>해당 PS 객체를 MFD에 등록한다.</li>
</ol>
<p>예를 들어 MFD를 만들고 G4PSEnergyDeposit과 G4PSDoseDeposit 두 개의 PS를 등록하는 경우를 코드로 작성한다면 다음과 같습니다.</p>
<pre><code class="language-cpp">auto mfd = new G4MultiFunctionalDetector(&quot;Detector&quot;);
G4SDManager::GetSDMpointer()-&gt;AddNewDetector(mfd);
auto psEDep = new G4PSEnergyDeposit(&quot;EDep&quot;);
mfd-&gt;RegisterPrimitive(psEDep);
auto psDoseDep = new G4PSDoseDeposit(&quot;DoseDep&quot;);
mfd-&gt;RegisterPrimitive(psDoseDep);
</code></pre>
<h4 id="filter-세팅하기">Filter 세팅하기</h4>
<p>Filter는 PS의 추가옵션 같은 기능입니다. Filter를 세팅하기 위해서는 PS를 등록할 때 Filter 관련 내용을 추가해야 합니다.</p>
<ol>
<li>원하는 Primitive Scorer 클래스의 객체를 만든다.</li>
<li><font color=red>원하는 Filter 클래스의 객체를 만든다.</font></li>
<li><font color=red>해당 Filter 객체를 PS에 세팅한다.</font></li>
<li>해당 PS 객체를 MFD에 등록한다.</li>
</ol>
<p>예를 들어, G4PSEnergyDeposit을 이용하는데, 전자(e-)가 deposit한 값만 스코어링하고 싶다면, 다음과 같이 작성하면 됩니다.</p>
<pre><code class="language-cpp">auto psEDep = new G4PSEnergyDeposit(&quot;EDep&quot;);
auto filterElectron = new G4SDParticleFilter(&quot;e-Filter&quot;, &quot;e-&quot;); // Create filter object
psEDep-&gt;SetFilter(filterElectron); // Set the filter to PS
mfd-&gt;RegisterPrimitive(psEDep);
</code></pre>
<p>각 Filter마다 생성자의 형태나 사용방법은 상이하므로, 여기서 자세히 다루지는 않겠습니다.</p>
<hr>
<h2 id="logical-volume에-sd-세팅">Logical Volume에 SD 세팅</h2>
<p>이제 관심 있는 지오메트리의 Logical Volume에, 앞서 설계한 SD를 세팅해줄 차례입니다. 이 내용 또한 <b>ConstructSDandField() 함수 내부</b>에 작성하며, 아주 간단하게 한 줄이면 끝납니다. <b>SetSensitiveDetector() 함수</b>를 사용하면 됩니다.</p>
<p>예를 들어, <b>&ldquo;phantom&quot;이라는 이름</b>을 가진 Logical Volume에 앞서 만든 <b>mfd</b> 변수명을 가진 SD를 세팅한다면, 다음과 같이 입력하면 됩니다.</p>
<pre><code class="language-cpp">SetSensitiveDetector(&quot;phantom&quot;, mfd);
</code></pre>
<p>좀 더 자세히 살펴보도록 합시다. 이 함수의 원형은 다음과 같습니다.</p>
<pre><code class="language-cpp">void SetSensitiveDetector(const G4String&amp; logVolName,
                          G4VSensitiveDetector* aSD, G4bool multi = false);
void SetSensitiveDetector(G4LogicalVolume* logVol, G4VSensitiveDetector* aSD);
</code></pre>
<ul>
<li>logVolName: 관심 있는 지오메트리의 <b>Logical Volume의 이름</b></li>
<li>aSD: Sensitive Detector 객체의 포인터</li>
<li><i>multi:  <b>입력하지 않아도 되는 인자</b>. logVolName 이름을 가진 지오메트리가 여러 개일 경우, 여러 개의 지오메트리 모두에 대해 SD를 세팅할지의 여부를 결정하는 인자. 기본값은 false</i></li>
<li>logVol: 관심 있는 지오메트리의 <b>Logical Volume 객체의 포인터</b></li>
</ul>
<p>SetSensitiveDetector 함수를 사용할 때, 관심 있는 지오메트리의 Logical Volume을 입력하는 방법이 두 가지입니다.</p>
<ol>
<li>Logical Volume의 이름을 입력</li>
<li>Logical Volume 객체의 포인터를 입력</li>
</ol>
<p>일단 이 시리즈에서 추천하는 바는 <b>그냥 Logical Volume의 이름을 입력하는 것</b>입니다. 제가 이전에 <a href="https://evandde.github.io/g4-noqasked-004-material/#logical-volume-%ec%a0%95%ec%9d%98%ed%95%98%ea%b8%b0" target="_blank" rel="noopener">Logical Volume을 정의하는 방법에 대해 적은 글</a>에서, <b>Logical Volume의 이름을 지을 때 다른 Logical Volume과 겹치지 않게끔 고유의 이름을 권장</b>한다고 하였습니다. 그 이유 중 하나가 이것입니다. 이름이 중복되면 그 중 어느 지오메트리에 SD를 세팅할 지가 불분명하기 때문입니다.</p>
<p>물론, 이름이 중복되는 모든 Logical Volume들에게 다 동일한 SD를 세팅하고자 한다면, 이 함수의 <i>multi</i> 인자 값을 true로 설정하여 사용할 수도 있습니다.</p>
<div class="alert alert-note">
  <div>
    <p>이 시리즈에서는 지역변수나 변수의 범위(scope) 등을 설명하기에는 지면이 부족하여, 그냥 Logical Volume의 이름을 사용하는 방법만 설명합니다.</p>
<p>일반적으로 Logical Volume 객체는 Construct() 함수 내에 지역변수로 만들기 때문에, ConstructSDandField() 함수에서는 그 객체를 호출하지 못하기 때문이지요.</p>
<p>물론 객체를 불러오기 위한 몇 가지 방법들이 있습니다만 여기서는 생략하도록 하겠습니다.</p>

  </div>
</div>

<hr>
<h2 id="중간-점검">중간 점검</h2>
<p>여기까지의 내용은 모두 <b>DetectorConstruction.cc 파일</b>에 있는 <b>ConstructSDandField() 함수 내부</b>에 작성하였습니다. 모두 마무리하셨다면, 일단 SD를 설계하고 이를 Logical Volume에 세팅하는 것까지 마친 상태입니다.</p>
<p>예를 들어 <b>G4PSEnergyDeposit 클래스를 이용하여 설계한 SD</b>를 <b>&ldquo;phantom&quot;이라는 이름을 가진 Logical Volume에 세팅</b>한다면, 다음과 같이 코드가 작성되어야 합니다.</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="02_consdandfield_complete" srcset="
               /g4-noqasked-011-scoring/02_consdandfield_complete_hudfe2e1998c310fd60c01f9222d12279a_10999_ef0db3ee3e7f2c8be3b55d7f4bea6056.png 400w,
               /g4-noqasked-011-scoring/02_consdandfield_complete_hudfe2e1998c310fd60c01f9222d12279a_10999_5d0f6efec8ea996e77db00e910019e1f.png 760w,
               /g4-noqasked-011-scoring/02_consdandfield_complete_hudfe2e1998c310fd60c01f9222d12279a_10999_1200x1200_fit_lanczos_3.png 1200w"
               src="/g4-noqasked-011-scoring/02_consdandfield_complete_hudfe2e1998c310fd60c01f9222d12279a_10999_ef0db3ee3e7f2c8be3b55d7f4bea6056.png"
               width="527"
               height="175"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>여기서 중간 점검을 하는 이유는, <b><font color=red>다음 내용부터는 작성하는 파일이 달라지기 때문</font></b>입니다. 놓치지 말고 잘 따라오세요.</p>
<hr>
<h2 id="event가-끝날-때-hit-확인">Event가 끝날 때 Hit 확인</h2>
<p>이제 마지막 단계입니다. 앞서 두 단계를 통해 Geant4는 알아서 <b>매 Event마다 Hit을 생성하고 이를 HitsCollection에 담아 HCofThisEvent로 묶어서 가지고 있을 것</b>입니다. Event가 끝날 때 사용자가 이 Hit을 꺼내서 확인하지 않으면, 그 정보들은 그대로 사라집니다. 메모리를 날려버리고 새로운 다음 Event에 대한 정보를 기록하지요.</p>
<p>사용자가 할 일은 <b>Event가 끝날 때마다</b> Hit을 가져와서 확인하는 것입니다.</p>
<p>Geant4는 <b>매 Event마다 특정 행동을 반복적으로 수행하는 용도로 활용</b>할 수 있게끔 하기 위해, <b>EventAction</b>이라는 개념을 제공하고 있습니다. 이 시리즈에서는 <b>EventAction.cc라는 파일</b>을 열어서 이용하시면 됩니다. 여기에는 BeginOfEventAction()이라는 함수와 EndOfEventAction()이라는 함수가 있는데, 이름 그대로 매 Event가 시작되기 직전과 끝난 직후에 해당 함수가 실행되는 식으로 동작합니다. 즉, 우리처럼 <b>매 Event가 끝날 때마다 무언가를 하고 싶다면 EndOfEventAction() 함수 안에 할 일을 적으면 되는 것</b>이죠.</p>
<div class="alert alert-note">
  <div>
    엄밀히 말하면, G4UserEventAction 클래스를 상속 받아서 사용자만의 고유한 EventAction클래스를 만들고, 이 클래스의 함수 중 BeginOfEventAction() 함수나 EndOfEventAction() 함수를 overriding하여 작성하면 그 내용이 매 Event가 시작되기 직전과 끝난 직후에 각각 실행됩니다.
  </div>
</div>

<p>EventAction.cc 파일을 열어보시면 아래쪽에 <b>EndOfEventAction() 함수</b>가 있을 것입니다. 이 함수 안에 내용을 작성할 것입니다.</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="03_EOE" srcset="
               /g4-noqasked-011-scoring/03_EOE_hub0f16bd98e7b7ed8780fe6e1639a4c13_78360_bfda29b346a7d6ba8bbb97592c6e9b27.png 400w,
               /g4-noqasked-011-scoring/03_EOE_hub0f16bd98e7b7ed8780fe6e1639a4c13_78360_f588572f86f87eb00204661b74f13d92.png 760w,
               /g4-noqasked-011-scoring/03_EOE_hub0f16bd98e7b7ed8780fe6e1639a4c13_78360_1200x1200_fit_lanczos_3.png 1200w"
               src="/g4-noqasked-011-scoring/03_EOE_hub0f16bd98e7b7ed8780fe6e1639a4c13_78360_bfda29b346a7d6ba8bbb97592c6e9b27.png"
               width="760"
               height="504"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>이미 다음과 같은 내용이 작성되어 있네요.</p>
<pre><code class="language-cpp">auto HCE = anEvent-&gt;GetHCofThisEvent();
if (!HCE)
	return;
</code></pre>
<p>의미는 그냥 써있는 그대로 읽으시면 됩니다. 한글로 쓰자면 다음과 같습니다.</p>
<ul>
<li>이번 Event에서 만들어진 HCofThisEvent를 가져와서 HCE라는 변수로 지정</li>
<li>만약 HCE가 유효하지 않다면
<ul>
<li>EndOfEventAction() 함수를 종료</li>
</ul>
</li>
</ul>
<p><del>어때요, 참 쉽죠?</del></p>
<p>HCE 변수가 유효하지 않다면 if 조건문에 의해 함수가 종료되어 버리므로, <b>이 내용 아래 부분에 있는 내용은 반드시 HCE가 유효한 경우에만 실행될 것</b>입니다.</p>
<p>이제 HCofThisEvent로부터 Hit까지 가보도록 합시다.</p>
<h3 id="hcofthisevent에서-hc-꺼내기">HCofThisEvent에서 HC 꺼내기</h3>
<p>HCofThisEvent는 HitsCollectoin들의 묶음이라고 하였습니다. 이 때 Geant4는 수많은 HC들을 쉽게 구분하기 위해 <b>HC마다 0 이상의 양의 정수값으로 된 고유의 ID번호를 부여</b>합니다. 다만, 사용자가 이 정수값을 직접 기억할 필요는 없습니다. 사용자는 <font color=red><b>HC의 이름</b></font>을 이용하여 이 ID번호를 찾아올 수 있기 때문입니다.</p>
<p>여기서 HC의 이름은 <b>Sensitive Detector를 설계할 때 결정</b>됩니다. 우리가 했던 것처럼 MFD와 PS를 이용할 경우에는, HC의 이름이 <code>{MFD의 이름}/{PS의 이름}</code>으로 결정됩니다. (대소문자 구분)</p>
<p>이 글에서 예시로 든 것처럼 다음과 같이 SD를 설계하였다면, <b><font color=red>HC의 이름은 &ldquo;Detector/EDep&rdquo;</font></b>이 되는 것입니다.</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="02_consdandfield_complete" srcset="
               /g4-noqasked-011-scoring/02_consdandfield_complete-16307684293331_hudfe2e1998c310fd60c01f9222d12279a_10999_8e7b434ea11101302068d22b6dc6009f.png 400w,
               /g4-noqasked-011-scoring/02_consdandfield_complete-16307684293331_hudfe2e1998c310fd60c01f9222d12279a_10999_f4a763251611466a8cdc890cc2777870.png 760w,
               /g4-noqasked-011-scoring/02_consdandfield_complete-16307684293331_hudfe2e1998c310fd60c01f9222d12279a_10999_1200x1200_fit_lanczos_3.png 1200w"
               src="/g4-noqasked-011-scoring/02_consdandfield_complete-16307684293331_hudfe2e1998c310fd60c01f9222d12279a_10999_8e7b434ea11101302068d22b6dc6009f.png"
               width="527"
               height="175"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>사용자는 이 HC의 이름만 있으면, G4SDManager로부터 GetCollectionID() 함수를 이용해 해당 HC의 고유 ID번호를 가져올 수 있습니다. 이는 다음의 코드 두 줄로 수행할 수 있습니다.</p>
<pre><code class="language-cpp">if(fHCID == -1)
	fHCID = G4SDManager::GetSDMpointer()-&gt;GetCollectionID(&quot;Detector/EDep&quot;);
</code></pre>
<div class="alert alert-note">
  <div>
    <pre><code class="language-cpp">G4int fHCID = G4SDManager::GetSDMpointer()-&gt;GetCollectionID(&quot;Detector/EDep&quot;);
</code></pre>
<p>이렇게 한 줄로 해도 될 일을 왜 굳이 if문으로 저런 이상한 조건을 붙이는 지 궁금한 분이 있으실 것입니다.</p>
<p>GetCollectionID() 함수는 시간을 많이 잡아먹는 느린 함수입니다. 이런 함수를 매 Event가 종료될 때마다 실행하도록 하면 그만큼 시뮬레이션에 소요되는 시간이 길어지겠지요.</p>
<p>이런 문제를 해결하고자, <b>맨 처음에만 HC의 ID를 찾아오고</b> 그 이후에는 전에 <b>찾아온 값을 재활용</b>하기 위해 이와 같이 코드를 작성하여 이용하는 것입니다.</p>

  </div>
</div>

<p>이어서, 이 ID를 이용하여 HCofThisEvent로부터 HC를 꺼내옵니다.</p>
<pre><code class="language-cpp">auto hitsMap = static_cast&lt;G4THitsMap&lt;G4double&gt; *&gt;(HCE-&gt;GetHC(fHCID));
</code></pre>
<p>이상한 문구가 너무 많이 있어서 생소하실 수 있겠지만, 해석해보면 간단합니다.</p>
<ul>
<li>
<p>HCE-&gt;GetHC(fHCID)</p>
<p>HCE(HCofThisEvent)로부터 fHCID라는 ID를 가진 HC를 가져옴</p>
</li>
<li>
<p>static_cast&lt;G4THitsMap<G4double> *&gt;(HCE-&gt;GetHC(fHCID))</p>
<p>앞서 가져온 HC를 <code>G4THitsMap&lt;G4double&gt; *</code> 자료형으로 형변환함</p>
</li>
<li>
<p>auto hitsMap = static_cast&lt;G4THitsMap<G4double> *&gt;(HCE-&gt;GetHC(fHCID));</p>
<p>이걸 hitsMap이라는 변수명으로 저장</p>
</li>
</ul>
<p>이제 모르는 내용은 <code>G4THitsMap&lt;G4double&gt; *</code>이라는 처음보는 자료형 뿐이군요. 이는 HitsCollection의 종류 중 하나입니다. <a href="https://evandde.github.io/g4-noqasked-010-scoringtheory/#ps-hit-hc%ec%97%90-%eb%8c%80%ed%95%9c-%ec%83%81%ec%84%b8-%ec%84%a4%eb%aa%85" target="_blank" rel="noopener">이전 글</a>에서 Hit을 저장하는 방법이 여러가지가 있지만, PS를 이용하는 경우에는 <b>값을 누적</b>하여 <b><font color=blue>하나의 값</font></b>으로 저장하며, 이를 <b><font color=red>Copy Number라는 사물함 번호로 분류</font></b>하여 저장한다고 했었지요.</p>
<p>C++에서 이처럼 사물함 번호마다 값을 분류하여 저장하는 데이터 저장 방식의 대표적인 예로 <b>Map</b>이 있습니다. 그래서 Geant4에서는 이 Map이라는 구조를 활용하여 Hit을 저장하기 위한 Map이라는 이름으로 G4THitsMap이라는 클래스를 사용하고 있으며, 그 Map에 저장될 데이터가 G4double(실수)형이라는 것을 명시하기 위해 <code>G4THitsMap&lt;G4double&gt;</code>과 같이 작성하게 됩니다. 끝의 <code>*</code>는 이 자료형의 포인터형이라는 뜻입니다.</p>
<p><u>이 설명을 잘 모르겠으면 그냥 넘어가시고, 나중에 C++ 공부를 좀 더 한 뒤에 이해하셔도 됩니다.</u> 핵심은 다음의 두 가지입니다. 이거만 기억하셔도 충분합니다.</p>
<ol>
<li>
<pre><code class="language-cpp">auto hitsMap = static_cast&lt;G4THitsMap&lt;G4double&gt; *&gt;(HCE-&gt;GetHC(fHCID));
</code></pre>
<p>라고 쓰면, hitsMap이라는 변수명으로 HitsCollection을 가져올 수 있음</p>
</li>
<li>
<p>이 hitsMap에는 <b><font color=red>Copy Number라는 사물함 번호</font></b>마다, <b><font color=blue>PS가 누적해서 기록한 값</font></b>이 저장되어 있음</p>
</li>
</ol>
<h3 id="hc에서-hit-꺼내기">HC에서 Hit 꺼내기</h3>
<p>앞서 가져온 HitsCollection에는 PS가 기록한 값이 Copy Number라는 번호로 분류된 사물함마다 저장되어 있을 것입니다.</p>
<p>어떤 사용자는 Sensitive Detector를 딱 하나의 지오메트리에만 달았을 수도 있고, 어떤 사용자는 여러 개의 지오메트리에 달았을 수도 있습니다. 게다가, 이 Event에서 입자들이 그 지오메트리들을 아예 안지나갔을 수도 있고(Hit이 0개), 모두 다 지나갔을 수도 있습니다.</p>
<p>이런 이유때문에, PS를 이용하여 설계한 SD를 이용한 경우에는 <b>HitsCollection 안에 몇 개의 Hit이 들어있을지 아무도 모릅니다</b>. 이런 모든 경우를 다 아우르기 위해, <b>HC안에 들어있는 Hit을 모두 다 훑으며 확인하는 방식을 이용</b>합니다. 이는 C++에서 제공하는 for-each 반복문을 사용하면 쉽게 해결됩니다.</p>
<pre><code class="language-cpp">for (const auto &amp;iter : *(hitsMap-&gt;GetMap()))
{
    // ...
}
</code></pre>
<p>위와 같이 작성하면, hitsMap 안에 있는 <b>모든 사물함</b>들을 <b>iter</b>라는 변수명으로 접근할 수 있게 됩니다. 이 때 <code>iter.first</code>는 <b><font color=red>사물함 번호</font></b>가 되고, <code>*(iter.second)</code>는 <b><font color=blue>그 사물함 안에 들어있는 hit의 누적 값</font></b>이 됩니다.</p>
<p>예를 들어, G4PSEnergyDeposit을 통해 기록된 deposit된 에너지의 총합을 살펴보고, 이 값이 0보다 큰 경우 터미널 화면에 출력하고자 한다면 다음과 같이 코드를 작성합니다.</p>
<pre><code class="language-cpp">for (const auto &amp;iter : *(hitsMap-&gt;GetMap()))
{
    auto eDep = *(iter.second);
    if (eDep &gt; 0.)
    {
    	G4cout &lt;&lt; &quot;--- Energy Deposit:&quot; &lt;&lt; eDep / MeV &lt;&lt; G4endl;
    }
}
</code></pre>
<div class="alert alert-note">
  <div>
    <code>G4cout</code>과 <code>G4endl</code>은 각각 <code>std::cout</code>과 <code>std::endl</code>과 동일하다고 생각하셔도 무방합니다.
  </div>
</div>

<p>해석하자면 다음과 같이 되겠군요</p>
<ul>
<li>hitsMap에 있는 사물함 각각을 iter라는 변수로 지정하여 반복문을 수행
<ul>
<li>사물함 안에 있는 값(<code>*(iter.second)</code>)을 eDep이라는 변수명으로 저장</li>
<li>만약 eDep의 값이 0보다 크다면
<ul>
<li>화면에 &ldquo;&mdash; Energy Deposit: &ldquo;과 &ldquo;eDep 값을 MeV로 나눈 값&quot;을 이어서 출력하고 줄바꿈</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>이런 방법을 통해 PS가 저장한 값을 Event가 끝날 때 가져와서 확인할 수 있게 됩니다. 지금까지 수행한 내용을 모두 작성하여 코드로 살펴보면 다음과 같습니다.</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="04_EOE_complete" srcset="
               /g4-noqasked-011-scoring/04_EOE_complete_hu07471f2f3de2bed73ed399c2fc9bd200_18600_4ff49cc7251b55f4d926279580379630.png 400w,
               /g4-noqasked-011-scoring/04_EOE_complete_hu07471f2f3de2bed73ed399c2fc9bd200_18600_9a5b8e6000e5d3f3d38fef773c49c8b6.png 760w,
               /g4-noqasked-011-scoring/04_EOE_complete_hu07471f2f3de2bed73ed399c2fc9bd200_18600_1200x1200_fit_lanczos_3.png 1200w"
               src="/g4-noqasked-011-scoring/04_EOE_complete_hu07471f2f3de2bed73ed399c2fc9bd200_18600_4ff49cc7251b55f4d926279580379630.png"
               width="716"
               height="443"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<h3 id="결과-확인">결과 확인</h3>
<p>이렇게 작성하였을 때 출력되는 결과를 살펴보겠습니다. 개수가 너무 적으면 확률상 원하는 결과가 나오지 않을수도 있으니, run.mac 파일에서 <code>/run/beamOn 100</code>이라고 되어있는 줄을 <code>/run/beamOn 1000</code>과 같이 약간 늘려주세요.</p>
<p>build 디렉토리에 들어와서, 다음 명령어를 통해 tracking verbose 1단계와 함께 출력해서 살펴봅시다.</p>
<pre><code class="language-bash">make
./g4_minimal run.mac &gt; vb.out
</code></pre>
<p>입자가 phantom에 들어가지 않은 다음과 같은 경우에는 추가적인 출력이 없는 것을 확인할 수 있습니다.</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="05_EOE_rslt1" srcset="
               /g4-noqasked-011-scoring/05_EOE_rslt1_hube3480bcdce8df8ce362d378679da3fb_29968_714dbcae9f79898a6e98973c89ec1ea7.png 400w,
               /g4-noqasked-011-scoring/05_EOE_rslt1_hube3480bcdce8df8ce362d378679da3fb_29968_04e8c30eb59b473d9a3d0b2dfa9ffa20.png 760w,
               /g4-noqasked-011-scoring/05_EOE_rslt1_hube3480bcdce8df8ce362d378679da3fb_29968_1200x1200_fit_lanczos_3.png 1200w"
               src="/g4-noqasked-011-scoring/05_EOE_rslt1_hube3480bcdce8df8ce362d378679da3fb_29968_714dbcae9f79898a6e98973c89ec1ea7.png"
               width="760"
               height="431"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>이제 phantom이라는 문구를 검색해 보겠습니다.</p>
<p>다음과 같이 phantom을 지나가긴 했지만, 별다른 반응이 일어나지 않아 deposit된 에너지가 없는 경우(<code>eDep &gt; 0.</code> 조건을 만족하지 못함)에도 추가적인 출력이 없는 것을 확인할 수 있습니다.</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="06_EOE_rslt2" srcset="
               /g4-noqasked-011-scoring/06_EOE_rslt2_hu3df22452996cf15d77a3335f68242939_23642_2bec1d7b18e0f716b9c5481538fb9011.png 400w,
               /g4-noqasked-011-scoring/06_EOE_rslt2_hu3df22452996cf15d77a3335f68242939_23642_8b5edf53684d289de130f0398cd4da06.png 760w,
               /g4-noqasked-011-scoring/06_EOE_rslt2_hu3df22452996cf15d77a3335f68242939_23642_1200x1200_fit_lanczos_3.png 1200w"
               src="/g4-noqasked-011-scoring/06_EOE_rslt2_hu3df22452996cf15d77a3335f68242939_23642_2bec1d7b18e0f716b9c5481538fb9011.png"
               width="760"
               height="306"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>좀 더 찾다보면 다음처럼 phantom에서 반응이 일어난 경우도 찾을 수 있습니다.</p>
<p>노란색으로 표시한 각 반응에서의 dE(MeV)들을 한 Event 내에서 다 합쳐져서, 그 총 합 값이 Event가 끝난 뒤에 <code>--- Energy Deposit:...</code>와 같이 출력되고 있음을 확인할 수 있습니다.</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="07_EOE_rslt3" srcset="
               /g4-noqasked-011-scoring/07_EOE_rslt3_hue3bba3d51fea93728d22ba41ad66cd1b_39083_3b205e1a10b8ad179606dc66dde338a4.png 400w,
               /g4-noqasked-011-scoring/07_EOE_rslt3_hue3bba3d51fea93728d22ba41ad66cd1b_39083_cc392163e3ce94fbee644f364d4acc62.png 760w,
               /g4-noqasked-011-scoring/07_EOE_rslt3_hue3bba3d51fea93728d22ba41ad66cd1b_39083_1200x1200_fit_lanczos_3.png 1200w"
               src="/g4-noqasked-011-scoring/07_EOE_rslt3_hue3bba3d51fea93728d22ba41ad66cd1b_39083_3b205e1a10b8ad179606dc66dde338a4.png"
               width="760"
               height="489"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<hr>
<h2 id="최종-파일-다운받는-법">최종 파일 다운받는 법</h2>
<p>이번 글에서 작성한 코드는 <a href="https://github.com/evandde/g4_minimal/archive/e14a65ec75c34ff35956cddada381d46d0802cbd.zip" target="_blank" rel="noopener">이 링크</a>를 통해 다운받을 수 있습니다.</p>
<p>혹은 git repository를 clone하신 분의 경우에는, example branch의 이전 커밋 중 V3 scoring이라는 커밋을 참고하셔도 됩니다.</p>
<hr>
<h2 id="정리">정리</h2>
<p>스코어링이 사실 쉽지 않습니다. 저도 많은 분들에게 강의를 수 차례 해보았지만, 제일 어려워하시는 부분이 스코어링입니다. C++의 문법을 모르면 생소한 코드가 너무 많아서 더욱 어려워보이는 것 같기도 합니다.</p>
<p>어떻게 하면 더 쉽게 전달할 수 있을까 많이 고민해 보았습니다만, 아직도 쉬워보이지는 않네요 
  <i class="far fa-frown  pr-1 fa-fw"></i></p>
<p>하지만 스코어링 이론을 잘 숙지하고 있으시다면, 몇 번만 직접 구현해서 활용해보면 금방 터득하실 수 있으리라 생각합니다.</p>
<p>이제 다음 내용이 이 시리즈의 마지막입니다. 다음 글부터는 스코어링 결과를 파일로 출력하는 법에 대해 알아보겠습니다.</p>
          </div>

          

<div class="article-tags">
  
  <a class="badge badge-light" href="/tags/geant4/">Geant4</a>
  
  <a class="badge badge-light" href="/tags/scoring/">Scoring</a>
  
  <a class="badge badge-light" href="/tags/multifunctionaldetector/">MultiFunctionalDetector</a>
  
  <a class="badge badge-light" href="/tags/primitivescorer/">PrimitiveScorer</a>
  
  <a class="badge badge-light" href="/tags/filter/">Filter</a>
  
</div>



          
          
          <div class="article-widget">
            
<div class="post-nav">
  
  
  
  <div class="post-nav-item">
    <div class="meta-nav">이전</div>
    <a href="/g4-noqasked-010-scoringtheory/" rel="next">Geant4 무작정 따라하기 - 10. 스코어링 이론</a>
  </div>
  
  
  
  <div class="post-nav-item">
    <div class="meta-nav">다음</div>
    <a href="/g4-noqasked-012-writingrslt1/" rel="prev">Geant4 무작정 따라하기 - 12. 스코어링 기록(Histogram)</a>
  </div>
  
</div>

          </div>
          
        </div>

        <div class="body-footer">
          <p>마지막 업데이트 Aug 18, 2021</p>

          





          


  
  
  

  
  
  

  
  <section id="comments">
    <script src="https://utteranc.es/client.js"
        repo="evandde/blog_comment"
        issue-term="url"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
  </section>
  



          


  
  
  <div class="article-widget content-widget-hr">
    <h3>관련문서</h3>
    <ul>
      
      <li><a href="/g4-noqasked-010-scoringtheory/">Geant4 무작정 따라하기 - 10. 스코어링 이론</a></li>
      
      <li><a href="/g4-noqasked-014-closing/">Geant4 무작정 따라하기 시리즈를 마치며</a></li>
      
      <li><a href="/g4-noqasked-013-writingrslt2/">Geant4 무작정 따라하기 - 13. 스코어링 기록(Ntuple)</a></li>
      
      <li><a href="/g4-noqasked-012-writingrslt1/">Geant4 무작정 따라하기 - 12. 스코어링 기록(Histogram)</a></li>
      
      <li><a href="/g4-noqasked-009-randtool/">Geant4 무작정 따라하기 - 9. 확률변수 이용하여 선원항 정의하기</a></li>
      
    </ul>
  </div>
  



        </div>

      </article>

      <footer class="site-footer">

  



  

  

  
  <p class="powered-by">
    © 2020–2021 Evan Kim
  </p>
  

  
  






  <p class="powered-by">
    
    
    
  </p>
</footer>


    </main>
  </div>
</div>

  </div>

  <div class="page-footer">
    
    
  </div>

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">인용</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> 복사
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> 다운로드
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

      

    
    <script src="/js/vendor-bundle.min.b73dfaac3b6499dc997741748a7c3fe2.js"></script>

    
    
    
      
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      

      
      

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/highlight.min.js" integrity="sha512-TDKKr+IvoqZnPzc3l35hdjpHD0m+b2EC2SrLEgKDRWpxf2rFCxemkgvJ5kfU48ip+Y+m2XVKyOCD85ybtlZDmw==" crossorigin="anonymous"></script>
        
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/autohotkey.min.js" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/bash.min.js" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/c.min.js" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/cmake.min.js" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/cpp.min.js" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/csharp.min.js" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/css.min.js" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/go.min.js" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/java.min.js" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/javascript.min.js" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/json.min.js" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/latex.min.js" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/makefile.min.js" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/markdown.min.js" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/matlab.min.js" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/powershell.min.js" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/python.min.js" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/scss.min.js" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/typescript.min.js" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/vbscript-html.min.js" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/xml.min.js" crossorigin="anonymous"></script>
        
      

    

    
    
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.2/anchor.min.js" integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin="anonymous"></script>
    <script>
      anchors.add();
    </script>
    

    
    
    
      
      <script id="search-hit-fuse-template" type="text/x-template">
        <div class="search-hit" id="summary-{{key}}">
          <div class="search-hit-content">
            <div class="search-hit-name">
              <a href="{{relpermalink}}">{{title}}</a>
              <div class="article-metadata search-hit-type">{{type}}</div>
              <p class="search-hit-description">{{snippet}}</p>
            </div>
          </div>
        </div>
      </script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
      
    

    
    

    
    
    
    

    
    
      
      
      
      
      
      
      
    

    
    
    
    
    
    
    
    
      
      
    
    
      
    
    <script src="/ko/js/wowchemy.min.c0ad5a97d2bc0d2861698a444011ffda.js"></script>

    <script src="https://unpkg.com/highlightjs-badge/highlightjs-badge.min.js"></script>
<script>
    setTimeout(function () {
        var pres = document.querySelectorAll("pre>code");
        for (var i = 0; i < pres.length; i++) {
            hljs.highlightBlock(pres[i]);
        }
        var options = {
            
            
            
            
            loadDelay:0,

            
            copyIconClass: "fa fa-copy",
            
            checkIconClass: "fa fa-check text-success",
          
            
            onBeforeTextCopied: function(text, codeElement) {
              return text;   
            }
        };
        window.highlightJsBadge(options);
    },10);
</script>


</body>
</html>
